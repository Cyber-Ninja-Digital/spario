async function populateTable(){document.getElementById("users-table-body").innerHTML="";let e=await db.collection("users").get();for(let a of e.docs){let t=a.data(),o=await db.collection("users").doc(a.id).collection("loginHistory").get(),d=[];o.forEach((e=>{let a=e.data();d.push(`Action: ${a.action}, Timestamp: ${a.timestamp.toDate()}`)}));const danePersonalneData=(await db.collection("users").doc(a.id).collection("dokumenty").doc("dane_personalne").get()).data()||{},aplikacjeData=(await db.collection("users").doc(a.id).collection("dokumenty").doc("aplikacje").get()).data()||{},samochodData=(await db.collection("users").doc(a.id).collection("dokumenty").doc("samochod").get()).data()||{};let s=document.createElement("tr"),n=document.createElement("td");n.innerText=t.driverId,s.appendChild(n);let i=document.createElement("td");i.innerText=t.email,s.appendChild(i);let r=document.createElement("td");r.innerText=t.firstName,s.appendChild(r);let l=document.createElement("td");l.innerText=t.lastName,s.appendChild(l);let c=document.createElement("td"),p=document.createElement("button");p.innerText="Show Login History",p.type="button",p.className="btn btn-info",p.dataset.toggle="modal",p.dataset.target=`#loginHistoryModal${a.id}`,c.appendChild(p),s.appendChild(c);let u=document.createElement("td"),h=document.createElement("button");h.innerText="Show Additional Info",h.type="button",h.className="btn btn-info",h.dataset.toggle="modal",h.dataset.target=`#additionalInfoModal${a.id}`,u.appendChild(h),s.appendChild(u);let m=document.createElement("td");m.innerText=t.systemStatus,s.appendChild(m);let w=document.createElement("div");w.className="modal fade",w.id=`additionalInfoModal${a.id}`,w.tabIndex="-1",w.role="dialog",w.innerHTML=`\n        <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title">User Details</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n\n      \n      <div class="modal-body">\n        <div class="dataBlock">\n          <h3>Dane personalne:</h3>\n          <p><strong>Driver ID:</strong> ${t.driverId||""}</p>\n<p><strong>Email:</strong> ${t.email||""}</p>\n<p><strong>Imię:</strong> ${t.firstName||""}</p>\n<p><strong>Nazwisko:</strong> ${t.lastName||""}</p>\n<p><strong>Numer telefonu:</strong> ${t.phoneNumber||""}</p>\n          <h7>Adres zamieszkania:</h7>\n          <p id="residence_address">${danePersonalneData.residenceAddress||""}</p>\n          <h7>Adres zameldowania:</h7>\n          <p id="registration_address">${danePersonalneData.registrationAddress||""}</p>\n          <h7>Adres korespondecyjny:</h7>\n          <p id="correspondence_address">${danePersonalneData.correspondenceAddress||""}</p>\n          <h7>Status pracy:</h7>\n          <p id="work_status">${danePersonalneData.workStatus||""}</p>\n          <h7>PESEL:</h7>\n          <p id="pesel">${danePersonalneData.pesel||""}</p>\n          <h7>Obywatelstwo:</h7>\n          <p id="citizenship">${t.citizenship||""}</p>\n          <h7>Data Urodzenia:</h7>\n          <p id="dob">${danePersonalneData.data_urodzenia||""}</p>\n          <h7>Rachunek Bankowy:</h7>\n          <p id="rachunek_bankowy">${danePersonalneData.rachunekBankowy||""}</p>\n          <h7>Dane personalne status:</h7>\n          <select id="personal_status_${a.id}" onchange="updateStatus('dane_personalne.status', '${a.id}', this.value)">\n            <option value="W trakcie sprawdzenia" ${"W trakcie sprawdzenia"===danePersonalneData.status?"selected":""}>W trakcie sprawdzenia</option>\n            <option value="Zaakceptowane" ${"Zaakceptowane"===danePersonalneData.status?"selected":""}>Zaakceptowane</option>\n            <option value="Odrzucone" ${"Odrzucone"===danePersonalneData.status?"selected":""}>Odrzucone</option>\n          </select>\n        </div>\n        <div class="dataBlock">\n          <h3>Aplikacje:</h3>\n          <h7>Bolt:</h7>\n          <p id="bolt">${aplikacjeData.Bolt||""}</p>\n          <h7>Uber:</h7>\n          <p id="uber">${aplikacjeData.Uber||""}</p>\n          <h7>FreeNow:</h7>\n          <p id="freenow">${aplikacjeData.FreeNow||""}</p>\n        </div>\n\n        <div class="dataBlock">\n          <h3>Dokumenty:</h3>\n          <h4>Prawo jazdy:</h4>\n          <h7>Prawo jazdy przód:</h7><a href="${samochodData.prawo_jazdy?.przod?.file||"#"}" target="_blank">otwórz dokument</a><br>\n          <h7>Prawo jazdy tyl:</h7><a href="${samochodData.prawo_jazdy?.tyl?.file||"#"}" target="_blank">otwórz dokument</a><br>\n          <h7>Prawo jazdy ważność:</h7>\n          <p id="driver_license_expiry">${samochodData.prawo_jazdy?.expiryDate||""}</p>\n          <h7>Prawo jazdy status:</h7>\n          <select id="driver_license_status" onchange="updateStatus('dokumenty.prawo_jazdy.status', '${a.id}', this.value)">\n  <option value="w trakcie sprawdzenia" ${"w trakcie sprawdzenia"===samochodData.prawo_jazdy?.status?"selected":""}>W trakcie sprawdzenia</option>\n  <option value="Zaakceptowane" ${"Zaakceptowane"===samochodData.prawo_jazdy?.status?"selected":""}>Zaakceptowany</option>\n  <option value="odrzucony" ${"odrzucony"===samochodData.prawo_jazdy?.status?"selected":""}>Odrzucony</option>\n</select>\n        </div>\n\n        <div class="dataBlock">\n          <h4>Dowód tożsamości:</h4>\n          <h7>Dowód tożsamości skan:</h7><a href="${samochodData.dowod_tozsamosci?.file||"#"}" target="_blank">otwórz dokument</a><br>\n          <h7>Dowód tożsamości ważność:</h7>\n          <p id="identity_proof_expiry">${samochodData.dowod_tozsamosci?.expiryDate||""}</p>\n          <h7>Dowód tożsamości status:</h7>\n          <select id="identity_proof_status_${a.id}" onchange="updateStatus('dokumenty.dowod_tozsamosci.status', '${a.id}', this.value)">\n            <option value="W trakcie sprawdzenia" ${"W trakcie sprawdzenia"===samochodData.dowod_tozsamosci?.status?"selected":""}>W trakcie sprawdzenia</option>\n            <option value="Zaakceptowane" ${"Zaakceptowane"===samochodData.dowod_tozsamosci?.status?"selected":""}>Zaakceptowane</option>\n            <option value="Odrzucone" ${"Odrzucone"===samochodData.dowod_tozsamosci?.status?"selected":""}>Odrzucone</option>\n          </select>\n        </div>\n\n        <div class="dataBlock">\n          <h3>Samochód:</h3>\n          <h4>Dowód rejestracyjny:</h4>\n          <h7>Typ samochodu:</h7>\n          <p id="car_type">${samochodData.car_type||""}</p>\n          <h7>Dowód rejestracji przód:</h7><a href="${samochodData.dowod_rejestracyjny?.przod?.file||"#"}" target="_blank">otwórz dokument</a><br>\n          <h7>Dowód rejestracji tyl:</h7><a href="${samochodData.dowod_rejestracyjny?.tyl?.file||"#"}" target="_blank">otwórz dokument</a><br>\n          <h7>Dowód rejestracji ważność:</h7>\n          <p id="car_registration_expiry">${samochodData.dowod_rejestracyjny?.expiryDate||""}</p>\n          <h7>Dowód rejestracji status:</h7>\n          <select id="car_registration_status_${a.id}" onchange="updateStatus('samochod.dowod_rejestracyjn.status', '${a.id}', this.value)">\n            <option value="W trakcie sprawdzenia" ${"W trakcie sprawdzenia"===samochodData.dowod_rejestracyjny?.status?"selected":""}>W trakcie sprawdzenia</option>\n            <option value="Zaakceptowane" ${"Zaakceptowane"===samochodData.dowod_rejestracyjny?.status?"selected":""}>Zaakceptowane</option>\n            <option value="Odrzucone" ${"Odrzucone"===samochodData.dowod_rejestracyjny?.status?"selected":""}>Odrzucone</option>\n          </select>\n        </div>\n\n        <div class="dataBlock">\n          <h4>Polisa OC:</h4>\n          <h7>Polisa OC skan:</h7><a href="${samochodData.polisa_oc?.file||"#"}" target="_blank">otwórz dokument</a><br>\n          <h7>Polisa OC ważność:</h7>\n          <p id="car_insurance_expiry">${samochodData.polisa_oc?.expiryDate||""}</p>\n          <h7>Polisa OC status:</h7>\n          <select id="car_insurance_status_${a.id}" onchange="updateStatus('samochod.polisa_oc.status', '${a.id}', this.value)">\n            <option value="W trakcie sprawdzenia" ${"W trakcie sprawdzenia"===samochodData.polisa_oc?.status?"selected":""}>W trakcie sprawdzenia</option>\n            <option value="Zaakceptowane" ${"Zaakceptowane"===samochodData.polisa_oc?.status?"selected":""}>Zaakceptowane</option>\n            <option value="Odrzucone" ${"Odrzucone"===samochodData.polisa_oc?.status?"selected":""}>Odrzucone</option>\n          </select>\n        </div>\n\n        \n      </div>\n    </div>\n  </div>\n`,u.appendChild(w);let y=document.createElement("div");y.className="modal fade",y.id=`loginHistoryModal${a.id}`,y.tabIndex="-1",y.role="dialog",y.innerHTML=`\n    <div class="modal-dialog" role="document">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h5 class="modal-title">User Details</h5>\n          <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n          </button>\n        </div>\n        <div class="modal-body">\n          ${d.join("<br>")}\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n        </div>\n      </div>\n    </div>\n  `,c.appendChild(y),document.getElementById("users-table-body").appendChild(s)}}async function updateStatus(e,a,t){await db.collection("users").doc(a).update({[e]:t})}populateTable();